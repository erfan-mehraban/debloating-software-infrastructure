#!/usr/bin/env bpftrace

tracepoint:syscalls:sys_enter_open,
tracepoint:syscalls:sys_enter_openat
/comm==str($1)/
{
	@filename[tid] = args->filename;
}

tracepoint:syscalls:sys_exit_open,
tracepoint:syscalls:sys_exit_openat
/@filename[tid]/
{
	if (args->ret >= 0) {
		printf("%s\n", str(@filename[tid]));
	}
	delete(@filename[tid]);
}

END
{
	clear(@filename);
}